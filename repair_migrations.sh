#!/bin/bash

# List of migrations to repair
migrations=(
    "20231205"
    "20240117235000"
    "20240117235100"
    "20240117235200"
    "20240117250000"
    "20240117260000"
    "20240117270000"
    "20240117280000"
    "20240117290000"
    "20240124000007"
    "20240124000008"
    "20240124000009"
    "20240124000010"
    "20240124000011"
    "20240124000012"
    "20240124000013"
    "20240124000014"
    "20240124000015"
    "20240124000016"
    "20240124000017"
    "20240124000018"
    "20240124000019"
    "20240124000020"
    "20240124000021"
    "20240124000022"
    "20240319000001"
    "20240319000002"
    "20240319000003"
    "20240319000004"
    "20240320000000"
    "20240320000001"
    "20240320000002"
    "20240320000003"
    "20240320000004"
    "20240320000005"
    "20240320000006"
    "20240320000007"
    "20240320000008"
    "20240321000000"
    "20240321000001"
    "20240321000002"
    "20240321000003"
    "20241214002851"
)

# Repair each migration
for migration in "${migrations[@]}"; do
    echo "Repairing migration $migration..."
    supabase migration repair --status applied "$migration"
done

# Pull the latest schema
echo "Pulling latest schema..."
supabase db pull

# Push our changes
echo "Pushing changes..."
supabase db push 